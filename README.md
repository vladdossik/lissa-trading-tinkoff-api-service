# Lissa Trading Tinkoff Service

**Tinkoff Service** предоставляет информацию о пользователе, таких как любимые акции, портфель и баланс, а также
информацию по акциям. Сервис взаимодействует с Tinkoff API и требует авторизации для выполнения запросов.

## Разработка на проекте

- Ветки называем по идентификатору задачи: `feat(STOCK-1)` или `bugfix(STOCK-1)`
- Креды от серверов, баз данных и других ресурсов не прописываем в коде, используем переменные окружения
- Все фичи проверяются локально, покрываются тестами (unit и integration), затем проверяются на сервере, и только после
  этого переводятся в done
- Комментарии к задаче пишем на английском языке с чётким описанием выполненной работы
- Одна ветка — одна задача. Несколько задач в одной ветке не допускаются
- Все сервисы используют одну базу данных с разными схемами
- Схема базы должна называться по имени сервиса, например: `user_service_db`

### Основные функции:

1. **Получение информации о пользователе**:
    - Портфель пользователя
    - Баланс и информация о счетах
    - Любимые акции
    - Маржинальные атрибуты
2. **Получение информации по акциям**:
    - Актуальная стоимость акций
    - Исторические данные
3. **Авторизация**:
    - Поддерживаются два типа токенов:
        - `JWT` токен для внешних пользователей
        - Внутренний `internal-token` для внутренних систем
    - Сервисный `tinkoff-token` для взаимодействия с Tinkoff API

### Архитектура:

#### Контроллеры:

- **AccountController**: Обрабатывает запросы, связанные с аккаунтом пользователя, включая информацию о портфеле и
  балансе.
- **StockController**: Отвечает за получение данных по акциям.
- **InternalController**: Управление внутренними системными операциями и проверка токенов.

#### Сервисы:

- **AccountService**: Управление данными аккаунта пользователя.
- **TinkoffAccountService**: Работа с данными аккаунта через Tinkoff API.
- **StockService**: Получение и обработка информации по акциям.
- **TinkoffStockService**: Получение данных о акциях через Tinkoff API.
- **AsyncTinkoffService**: Асинхронное взаимодействие с Tinkoff API для повышения производительности.

#### Токен и Конфигурация:

- **TokenUpdateService**: Обновление и проверка токенов.
- **ApiConfig** и **ApplicationConfig**: Конфигурации взаимодействия с Tinkoff API и настройка авторизации.

### Безопасность:

Конфигурация безопасности основана на проверке JWT токенов и внутренних системных токенов для взаимодействия с API.

---

## Kubernetes Deployment

Для развёртывания сервиса в Kubernetes предусмотрены следующие конфигурационные файлы:
`deployment.yaml`, `service.yaml`.